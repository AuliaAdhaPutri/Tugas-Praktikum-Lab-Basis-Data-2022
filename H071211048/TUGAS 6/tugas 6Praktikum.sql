use classicmodels;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         

-- no1
select customers.customerName as 'Nama Pelanggan ', sum(amount) as 'Total Belanja', creditLimit as 'Batas Kredit', sum(amount) - creditLimit as 'Selisih'
from customers
join payments as p on p.customerNumber = customers.customerNumber
group by customers.customerName
having sum(amount) > creditLimit
order by sum(amount) - creditLimit desc
limit 5;

-- no2  
select concat(customerName,' : ', contactFirstName, contactLastName, "@", addressLine1) as Pelanggan, sum(quantityOrdered) as 'Jumlah Orderan'
from customers
join orders as o on customers.customerNumber = o.customerNumber
join orderdetails as ord on o.orderNumber = ord.orderNumber
group by customerName
order by sum(quantityOrdered) desc limit 1 ;

-- no3  
select concat(monthname(paymentDate), ' ' ,year(paymentDate)) as 'Hari Pembayaran' , count(customerName) as 'Jumlah Pelanggan', 
group_concat(distinct customers.customerName separator ',') as 'List Pelanggan', sum(amount) as 'Jumlah Pembayaran'
from customers
join payments as p on p.customerNumber = customers.customerNumber
where month(paymentDate) = 2
group by concat(monthname(paymentDate), ' ' ,year(paymentDate))
order by count(customerName) desc;

-- no4
select upper(productName) as 'Nama Produk', count(quantityOrdered) as 'Jumlah Orderan', group_concat(orderdate separator ' , ') as 'Waktu Orderan', 
buyPrice as 'Harga Beli', priceEach as 'Harga Jual', sum(quantityOrdered) as 'Total Jumlah Orderan', 
concat(priceEach * sum(quantityOrdered), '-', buyPrice*sum(quantityOrdered), '=', 
sum(quantityOrdered)*(priceEach-buyPrice)) as 'Pendapatan - Modal = Keuntungan'
from products 
join orderdetails as ord on ord.productCode = products.productCode
join orders as o on ord.orderNumber = o.orderNumber
where productName like '%enzo%'
group by priceEach
having sum(ord.quantityOrdered) * (ord.priceEach - products.buyPrice) > 5000
order by sum(quantityOrdered)*(priceEach-buyPrice) desc;

-- no5
select offices.addressLine1 as 'Alamat', replace(offices.phone, right(offices.phone,6),  '* ****') as 'Nomor Telp', 
count(distinct e.firstName) as 'Jumlah Karyawan',count(distinct c.customerName) as 'Jumlah Pelanggan', 
round(avg(amount), 2) as 'Rata-rata Penghasilan'
from offices
join employees as e on offices.officeCode = e.officeCode
left join customers as c on c.salesRepEmployeeNumber= e.employeeNumber
left join payments as p on c.customerNumber = p.customerNumber
group by offices.addressLine1
order by round(avg(amount), 2);